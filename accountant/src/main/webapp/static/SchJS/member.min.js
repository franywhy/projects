
$(document).ready(function (e) {

    $.ajax({
        type: "POST",
        url: "/lib/member/member.ashx",
        data: "type=1",
        cache: false,
        success: function (result) {
            if (result != "000") {
                var dataObj = eval("(" + result + ")"); //转换为json对象 
                $("#nickname ").val(dataObj.nickname);
                $("#realname ").val(dataObj.realname);
                $("#degree ").val(dataObj.degree);
                $("#phone ").val(dataObj.phone);
                $("#email ").val(dataObj.email);
                $("#memo").val(dataObj.memo);
                $("#hidSex").val(dataObj.sex);
                if (dataObj.birthdate != null) {
                    setbirthdate(dataObj.birthdate);
                }

                $("a[rel='" + dataObj.sex + "']").addClass("active");
            }
        }
    });

    $(".xb a").click(function (event) {
        var id = $(this).attr('rel');
        $(this).addClass("active").siblings().removeClass("active");
        $("a[rel='" + id + "']").addClass("active");
        $("#hidSex").val(id);
    });

});

$(function () {
    $("#saveUserInfo").click(function () {
        if ($("#nickname").val() == "") {
            $("#msgnickname").html("昵称不能为空");
            $("#nickname").focus();
            return false;
        }
        else {
            $("#msgnickname").html("");
        }

        if ($("#phone").val() != "") {
            if (!$("#phone").val().match(/^\d{11}$/)) {
                $("#msgphone").html("手机号码格式不正确");
                $("#phone").focus();
                return false;
            }
            else {
                $("#msgphone").html("");
            }
        }
        else {
            $("#msgphone").html("");
        }

        if ($("#email").val() != "") {
            if (!$("#email").val().match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)) {
                $("#msgmail").html("邮箱格式不正确");
                $("#email").focus();
                return false;
            }
            else {
                $("#msgmail").html("");
            }
        }
        else {
            $("#msgmail").html("请输入常用电子邮箱");
            $("#email").focus();
        }

        $.ajax({
            type: "POST",
            url: "/lib/member/member.ashx",
            data: {
                type: "2",
                nickname: $("#nickname").val(),
                realname: $("#realname").val(),
                sex: $("#hidSex").val(),
                birthdate: $("[id$=ddl_Year]").val() + "-" + $("[id$=ddl_Month]").val() + "-" + $("[id$=ddl_Day]").val(),
                degree: $("#degree").val(),
                memo: $("#memo").val(),
                phone: $("#phone").val(),
                email: $("#email").val()
            },
            cache: false,
            beforeSend: function () {

            },
            success: function (result) {
                $("#mode_tips").html("<span class='gtl_ico_hits'></span>" + result + "");
                openStaticPopup();
                setTimeout("location.href='studyCenter.html';", 2000);
            }
        });
    });
});

function timeStamp2String(time) {
    var datetime = new Date();
    datetime.setTime(time);
    var year = datetime.getFullYear();
    var month = datetime.getMonth() + 1 < 10 ? "0" + (datetime.getMonth() + 1) : datetime.getMonth() + 1;
    var date = datetime.getDate() < 10 ? "0" + datetime.getDate() : datetime.getDate();
    var hour = datetime.getHours() < 10 ? "0" + datetime.getHours() : datetime.getHours();
    var minute = datetime.getMinutes() < 10 ? "0" + datetime.getMinutes() : datetime.getMinutes();
    var second = datetime.getSeconds() < 10 ? "0" + datetime.getSeconds() : datetime.getSeconds();
    return year + "-" + month + "-" + date + " " + hour + ":" + minute + ":" + second;
}

function setbirthdate(time) {
    var obj = time;
    var date = eval(obj.replace(/\/Date\((\d+)\)\//gi, "new Date($1)"));
    $("[id$=ddl_Year]").val(date.getFullYear());
    $("[id$=ddl_Month]").val(date.getMonth() + 1);
    $("[id$=ddl_Day]").val(date.getDate());
}

function ajaxFileUpload() {

    $.ajaxFileUpload({
        url: '/lib/Handler.ashx',
        type: 'post',
        secureuri: false, //一般设置为false
        fileElementId: 'imgUpload', // 上传文件的id、name属性名
        dataType: 'json', //返回值类型 一般设置为json
        success: function (data, status) {

        },
        error: function (data, status, e) {

        }
    });
}

try {
    $.setupJMPopups({
        screenLockerBackground: "#003366",
        screenLockerOpacity: "0.5"
    });
} catch (e) { }

function openStaticPopup() {
    $.openPopupLayer({
        name: "myStaticPopup",
        width: 1000,
        target: "myHiddenDiv1"
    });
}