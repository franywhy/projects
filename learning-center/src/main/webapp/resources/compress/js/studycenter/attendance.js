window.pageScript=(new function(){var t=this;t.classType="",t.userPlanId="",t.stopTime="",t.reopenTime="",t.cause="",t.businessId=pageParam.businessId,t.attendanceId=null,this.init=function(){return t.datetimepicker(".datetimepicker"),t.bindEvent(),t},this.bindEvent=function(){$("#applyBtn").click(function(){$("#attFormLayer .mask-layer").show(300)}),$("#attFormLayer .grey-close-p").click(function(){$("#attFormLayer .mask-layer").hide(300)}),$("#classType").click(function(){$("#selectList").is(":hidden")?($("#classType input").css("background","#e6e6e6"),$("#selectList").slideDown()):($("#selectList").slideUp(),$("#classType input").css("background","#fff"))}),$("#selectList > .select-list").click(function(){var e=$(this).text();$("#classType input").val(e),t.userPlanId=$(this).attr("data-id"),$("#selectList").slideUp(),$("#classType input").css("background","#fff")}),$("#cancelBtn,#cancelConfirmLayer .grey-close-p").click(function(){$("#cancelConfirmLayer .mask-layer").hide(300)}),$("#confirmBtn").click(function(){t.cancelRequset()}),$("#form").submit(function(){return t.checkForm()&&t.submitForm(),!1})},this.datetimepicker=function(e){$.datetimepicker.setLocale("ch"),$(e).datetimepicker({value:"",format:"Y-m-d",maxDate:!1,maxTime:!1,minDate:new Date,minTime:"0",yearStart:2017,yearEnd:"2100",allowBlank:!1,allowTimes:[],inline:!1,todayButton:!0,datepicker:!0,weeks:!1,timepicker:!1})},this.checkForm=function(){return t.classType=$.trim($("#classType input").val()),t.stopTime=$.trim($("#stopTime input").val()),t.reopenTime=$.trim($("#reopenTime input").val()),t.cause=$.trim($("#cause textarea").val()),""==t.classType?($("#promptText .text-se").text("请输入完整的休学申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1):""==t.stopTime?($("#promptText .text-se").text("请输入完整的休学申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1):""==t.reopenTime?($("#promptText .text-se").text("请输入完整的休学申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1):hqTool.replaceNumber(t.stopTime)>hqTool.replaceNumber(t.reopenTime)?($("#promptText .text-se").text("开始时间不能大于结束时间"),$("#promptText").css("display","inline-block"),!1):""!=t.cause||($("#promptText .text-se").text("请输入完整的休学申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1)},this.submitForm=function(){hqTool.showLoad(t.businessId),$.ajax({url:"/learningCenter/web/courseabnormalorder/save",type:"GET",async:!0,data:{orderId:t.userPlanId,startTime:t.stopTime,expectEndTime:t.reopenTime,abnormalReason:t.cause},dataType:"json",success:function(e){return hqTool.hideLoad(),$("#promptText").hide(),200==e.code?window.location.reload():alert(e.message),!1}})},this.cancel=function(e){t.attendanceId=e,$("#cancelConfirmLayer .mask-layer").show(300)},this.cancelRequset=function(){if(null==t.attendanceId)return!1;hqTool.showLoad(t.businessId),$.ajax({url:"/learningCenter/web/courseabnormalorder/updateCancel",type:"GET",async:!0,data:{id:t.attendanceId},dataType:"json",success:function(e){return hqTool.hideLoad(),200==e.code?window.location.reload():alert(e.message),!1}})}}).init();