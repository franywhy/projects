window.pageScript=(new function(){var i=this;i.classType="",i.userPlanId="",i.course="",i.courseId="",i.provinceId="",i.timeId="",i.registerNum="",i.businessId=pageParam.businessId,i.attendanceId=null,this.init=function(){return i.bindEvent(),i},this.bindEvent=function(){$("#applyBtn").click(function(){$("#attFormLayer .mask-layer").show(300)}),$("#attFormLayer .grey-close-p").click(function(){$("#attFormLayer .mask-layer").hide(300)}),$("#classType").click(function(){i.sliderAction($(this))}),$("#course").click(function(){if(""==$.trim($("#classType input").val()))return $("#promptText .text-se").text("请先选择班型"),$("#promptText").css("display","inline-block"),!1;i.sliderAction($(this))}),$("#province").click(function(){i.sliderAction($(this))}),$("#time").click(function(){i.sliderAction($(this))}),$("#selectList > .select-list").click(function(){var t=$(this).text();$(this).parent().parent().find("input").val(t),i.userPlanId=$(this).attr("data-id"),$(this).parent().slideUp(),$(this).parent().parent().find("input").css("background","#fff"),i.getCourseList()}),$("#selectList3 > .select-list").click(function(){var t=$(this).text();$(this).parent().parent().find("input").val(t),i.provinceId=$(this).attr("data-id"),$(this).parent().slideUp(),$(this).parent().parent().find("input").css("background","#fff")}),$("#selectList4 > .select-list").click(function(){var t=$(this).text();$(this).parent().parent().find("input").val(t),i.timeId=$(this).attr("data-id"),$(this).parent().slideUp(),$(this).parent().parent().find("input").css("background","#fff")}),$("#cancelBtn,#cancelConfirmLayer .grey-close-p").click(function(){$("#cancelConfirmLayer .mask-layer").hide(300)}),$("#confirmBtn").click(function(){i.cancelRequset()}),$("#form").submit(function(){return i.checkForm()&&i.submitForm(),!1})},this.getCourseList=function(){hqTool.showLoad(i.businessId),$.ajax({url:"/learningCenter/web/courseAbnormallRegistration/courseListByOrderId",type:"GET",async:!0,data:{orderId:i.userPlanId},dataType:"json",success:function(t){if(hqTool.hideLoad(),200!=t.code)return alert(t.message),!1;if($("#course input").val(""),$("#selectList2").empty(),null!=t.data)for(var e=0;e<t.data.length;e++)$("#selectList2").append('<div class="select-list" data-id="'+t.data[e].courseId+'" onclick="pageScript.selectList($(this))">'+t.data[e].courseName+"</div>");return!1}})},this.checkForm=function(){var t=new RegExp(/^[0-9A-Za-z]+$/);return i.classType=$.trim($("#classType input").val()),i.course=$.trim($("#course input").val()),i.province=$.trim($("#province input").val()),i.time=$.trim($("#time input").val()),i.registerNum=$.trim($("#registerNum input").val()),""==i.classType?($("#promptText .text-se").text("请输入完整的报考申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1):""==i.course?($("#promptText .text-se").text("请输入完整的报考申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1):""==i.province?($("#promptText .text-se").text("请输入完整的报考申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1):""==i.time?($("#promptText .text-se").text("请输入完整的报考申请内容，不能有为空项。"),$("#promptText").css("display","inline-block"),!1):!(!t.test(i.registerNum)&&""!=i.registerNum&&($("#promptText .text-se").text("报考登记号只能输入数字或字母"),$("#promptText").css("display","inline-block"),1))},this.submitForm=function(){hqTool.showLoad(i.businessId),$.ajax({url:"/learningCenter/web/courseAbnormallRegistration/save",type:"GET",async:!0,data:{orderId:i.userPlanId,courseId:i.courseId,areaId:i.provinceId,scheduleId:i.timeId,registerPK:i.registerNum},dataType:"json",success:function(t){return hqTool.hideLoad(),$("#promptText").hide(),200==t.code?window.location.reload():alert(t.message),!1}})},this.cancel=function(t){i.attendanceId=t,$("#cancelConfirmLayer .mask-layer").show(300)},this.cancelRequset=function(){if(null==i.attendanceId)return!1;hqTool.showLoad(i.businessId),$.ajax({url:"/learningCenter/web/courseAbnormallRegistration/updateCancel",type:"GET",async:!0,data:{id:i.attendanceId},dataType:"json",success:function(t){return hqTool.hideLoad(),200==t.code?window.location.reload():alert(t.message),!1}})},this.sliderAction=function(t){$(".select-bar .select").slideUp(),$(".select-bar input").css("background","#fff"),t.parent().find(".select").is(":hidden")&&(t.parent().find("input").css("background","#e6e6e6"),t.parent().find(".select").slideDown())},this.selectList=function(t){var e=t.text();t.parent().parent().find("input").val(e),i.courseId=t.attr("data-id"),t.parent().slideUp(),t.parent().parent().find("input").css("background","#fff"),$("#promptText").hide()}}).init();