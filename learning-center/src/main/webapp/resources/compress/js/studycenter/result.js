window.pageScript=(new function(){var s=this;s.businessId=pageParam.businessId,s.registrationId="",s.course="",s.ordername="",s.registerpk="",s.registerproinve="",s.scheduledate="",s.score="",s.img="",this.init=function(){return s.bindEvent(),s},this.bindEvent=function(){$("#chooseCourse").click(function(){if(""==$.trim($("#chooseList").text()))return alert("暂无报考课程"),!1;$("#chooseList").is(":hidden")?($("#chooseCourse .solid-down-arrow-icon").css("transform","rotate(180deg)"),$("#chooseList").slideDown()):($("#chooseCourse .solid-down-arrow-icon").css("transform","rotate(0deg)"),$("#chooseList").slideUp())}),$("#chooseList .select-list").click(function(){s.registrationId=$(this).attr("data-id"),s.ordername=$(this).attr("data-ordername"),s.registerpk=$(this).attr("data-registerpk"),s.registerproinve=$(this).attr("data-registerproinve"),s.scheduledate=$(this).attr("data-scheduledate"),s.course=$(this).text(),$("#chooseCourse .ipt-placeholder").text(s.course),$("#chooseCourse .ipt-placeholder").css("color","#535353"),$("#num").val(s.registerpk),$("#province").val(s.registerproinve),$("#time").val(s.scheduledate),$("#classType").val(s.ordername),$("#chooseList .select-list").removeClass("active"),$(this).addClass("active"),$("#chooseCourse .solid-down-arrow-icon").css("transform","rotate(0deg)"),$("#chooseList").slideUp()}),$("#uploadImg").change(function(){var e=$(this).val(),t=e.lastIndexOf("."),r=e.substring(t,e.length).toUpperCase();if(".BMP"!=r&&".PNG"!=r&&".JPG"!=r&&".JPEG"!=r)return $(this).val(""),alert("只支持jpg、jpeg、png、bmp等格式的图片"),!1;if(s.isIE()){var o=new Image;if(o.src=e,"complete"==o.readyState)return 5120<parseInt(o.fileSize/1024)&&alert("上传的图片大小不能超过5M！"),!1;o.onreadystatechange=function(){if("complete"==o.readyState)return 5120<parseInt(o.fileSize/1024)&&alert("上传的图片大小不能超过5M！"),!1}}else if(5120<this.files[0].size/1024)return $(this).val(""),alert("上传的图片大小不能超过5M！"),!1;s.uploadImg()}),$("#uploadImg").hover(function(){1==$("#uploadImgIcon").attr("data-type")&&$("#uploadImgMaskBox").show()},function(){1==$("#uploadImgIcon").attr("data-type")&&$("#uploadImgMaskBox").hide()}),$("#sub").click(function(){if(!s.checkForm())return!1;$("#previewCourse").val(s.course),$("#previewNumber").val(s.registerpk),$("#previewProvince").val(s.registerproinve),$("#previewTime").val(s.scheduledate),$("#previewClassType").val(s.ordername),$("#previewScore").val(s.score),""!=s.img?$("#previewImg").attr("src",s.img):$("#previewImg").parent().hide(),$("#resultFormLayer .mask-layer").show(300)}),$("#resultFormLayer .grey-close-p").click(function(){$("#resultFormLayer .mask-layer").hide(300)}),$("#confirmSubmit").click(function(){if(!s.checkForm())return!1;s.submitForm()}),$("#cancel").click(function(){$("#resultFormLayer .mask-layer").hide(300)})},this.uploadImg=function(){var e=new FormData;e.append("file",$("#uploadImg")[0].files[0]),e.append("sourceId",1),hqTool.showLoad(s.businessId),$.ajax({url:"http://file.hqjy.com/file/singleDirectUpload",type:"POST",cache:!1,data:e,processData:!1,contentType:!1,dataType:"json",success:function(e){return hqTool.hideLoad(),200==e.code?(s.img=e.data,$("#uploadImgIcon").attr("src",s.img),$("#uploadImgIcon").attr("data-type",1)):alert(e.message),!1},error:function(e,t,r){hqTool.hideLoad(),console.error(r)}})},this.checkForm=function(){return s.score=$.trim($("#score").val()),""==s.registrationId?(alert("请选择课程"),!1):""==s.score?(alert("请输入统考成绩"),!1):/^[0-9]*$/.test(s.score)?!(s.score<=-1||101<=s.score)||(alert("分数范围请控制在0~100之间"),!1):(alert("统考成绩只能输入纯数字"),!1)},this.submitForm=function(){hqTool.showLoad(s.businessId),$.ajax({url:"/learningCenter/web/examinationResult/save",type:"GET",async:!0,data:{registrationId:s.registrationId,score:s.score,img:s.img},dataType:"json",success:function(e){return hqTool.hideLoad(),200==e.code?window.location.reload():alert(e.message),!1}})},this.isIE=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)}}).init();