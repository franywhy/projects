!function(){var h={year:null,month:null,isShow:"hide",userPlanId:hqTool.getUrlParam("userplanId"),oldTime:hqTool.getUrlParam("oldTime"),today:"",selectedDay:"",oneLoad:!0,prevDate:hqTool.getTime(2),currentFirstDate:new Date,isPrevNext:!0,businessId:pageParam.businessId,init:function(){var a=h,e=new Date;if(h.year=e.getFullYear(),h.month=e.getMonth()+1,null!=h.oldTime){var t=hqTool.getTime(2),s=h.DateDiff(t,h.oldTime),n=parseInt("-"+s);h.currentFirstDate=h.addDate(e,n),h.setDate(h.addDate(e,0)),h.selectedDay=h.oldTime;var i=h.oldTime.split("-")[0],d=h.oldTime.split("-")[1];$(".f-year").html(i),$(".f-month").html(d),h.isShow="show",h.getWeekData(),h.oneLoad=!1}else $(".f-year").html(h.year),$(".f-month").html(h.month),h.setDate(e);return h.addStyle(),a.bindEvent(),a},bindEvent:function(){$("#showMore").click(function(){$(this).find(".black-arrow-icon").hasClass("down-arrow-icon")?h.getCalendarData():h.getWeekData()})},TodaySelected:function(a){h.isPrevNext=!1,h.selectedDay=a.find(".f-day").attr("data-id"),a.hasClass("f-on")||a.hasClass("f-today-se")||(h.getContent(),$(".f-rili-table .f-td").each(function(a,e){$(this).hasClass("f-today-se")&&($(this).removeClass("f-today-se"),$(this).addClass("f-today"))}),$(".f-rili-table .f-td").removeClass("f-on"),a.addClass("f-on")),h.initWeek(!1,a)},selectedDayStyle:function(){$(".f-rili-table .f-number").each(function(a,e){var t=$(this).find(".f-day").attr("data-id");$(this).hasClass("f-today-se")&&($(this).removeClass("f-today-se"),$(this).addClass("f-today")),h.selectedDay==t&&($(".f-rili-table .f-number").removeClass("f-on"),$(this).addClass("f-on"),h.getContent())})},addStyle:function(){for(var a=0;a<$(".f-rili-table .f-tbody .f-td").length;a++)a%7==0?$(".f-rili-table .f-tbody .f-td").eq(a).addClass("ml-0px"):(a+1)%7==0&&$(".f-rili-table .f-tbody .f-td").eq(a).addClass("mr-0px");var e=parseInt($(".f-year").html()),t=parseInt($(".f-month").html());if(null==h.oldTime){if(h.year==e&&h.month==t){var s=(new Date).getDate();$(".f-rili-table .f-number").each(function(a,e){var t=$(this).find(".f-day").text();if(s==t)return h.oneLoad&&(h.selectedDay=$(this).find(".f-day").attr("data-id"),h.today=h.selectedDay),$(".f-rili-table .f-number").removeClass("f-today-se"),$(this).addClass("f-today-se"),!1}),h.oneLoad&&(h.getContent(),h.oneLoad=!1)}}else if(h.year==e&&h.month==t){s=(new Date).getDate();$(".f-rili-table .f-number").each(function(a,e){var t=$(this).find(".f-day").text();if(s==t)return $(".f-rili-table .f-number").removeClass("f-today"),$(this).addClass("f-today"),!1})}},prevMonth:function(a){var e=parseInt($(".f-year").html()),t=parseInt($(".f-month").html()),s="";if(h.selectedDay=a.find(".f-day").attr("data-id"),$("#showMore").find(".black-arrow-icon").hasClass("down-arrow-icon")){h.isShow="show",h.isPrevNext=!0,a.hasClass("f-lastMonth")?h.initWeek(!1,a):h.setDate(h.addDate(h.currentFirstDate,-7));var n=h.selectedDay.split("-")[0],i="";i=(s=h.selectedDay.split("-")[1])<10?parseInt(s):s,$(".f-year").text(n),$(".f-month").text(i),h.getWeekData()}else{if(h.isPrevNext=!1,1==t?($(".f-year").html(e-1),$(".f-month").html(12)):$(".f-month").html(t-1),void 0===a.find(".f-day").attr("data-id")){var d=$(".f-year").text(),l=$(".f-month").text();s=l.toString().length<=1?"0"+l:l,h.selectedDay=d+"-"+s+"-01"}else h.selectedDay=a.find(".f-day").attr("data-id");h.getCalendarData(function(){h.prevNextMonth()})}},nextMonth:function(a){var e=parseInt($(".f-year").html()),t=parseInt($(".f-month").html()),s="";if(h.selectedDay=a.find(".f-day").attr("data-id"),$("#showMore").find(".black-arrow-icon").hasClass("down-arrow-icon")){h.isShow="show",h.isPrevNext=!0,a.hasClass("f-nextMounth")?h.initWeek(!0,a):h.setDate(h.addDate(h.currentFirstDate,7));var n=h.selectedDay.split("-")[0],i="";i=(s=h.selectedDay.split("-")[1])<10?parseInt(s):s,$(".f-year").text(n),$(".f-month").text(i),h.getWeekData()}else{if(h.isPrevNext=!1,12==t?($(".f-year").html(e+1),$(".f-month").html(1)):$(".f-month").html(t+1),void 0===a.find(".f-day").attr("data-id")){var d=$(".f-year").text(),l=$(".f-month").text();s=l.toString().length<=1?"0"+l:l,h.selectedDay=d+"-"+s+"-01"}else h.selectedDay=a.find(".f-day").attr("data-id");h.getCalendarData(function(){h.prevNextMonth()})}},currentMonth:function(){var a=new Date,e=a.getFullYear(),t=a.getMonth()+1;$(".f-year").html(e),$(".f-month").html(t)},initWeek:function(a,e){var t="",s=new Date,n=h.DateDiff(h.formatDate(s),h.selectedDay),i=e.find(".f-day").attr("data-id").split("-"),d=i[0]+i[1]+i[2],l=h.today.split("-"),r=l[0]+l[1]+l[2];t=r<d?parseInt(n):parseInt("-"+n),h.currentFirstDate=h.addDate(s,t),h.setDate(h.addDate(h.currentFirstDate,0))},prevNextMonth:function(){var a=new Date;if(h.currentFirstDate=a,h.formatDate(a)>h.selectedDay){var e=h.DateDiff(h.selectedDay,h.formatDate(a)),t=parseInt("-"+e);h.setDate(h.addDate(h.currentFirstDate,t))}else{e=h.DateDiff(h.formatDate(a),h.selectedDay);h.setDate(h.addDate(h.currentFirstDate,e))}},getCalendarData:function(d){hqTool.showLoad(h.businessId),$.ajax({url:"/learningCenter/web/live/calendar/mon",type:"GET",async:!0,data:{userplanId:h.userPlanId,date:h.selectedDay},dataType:"json",success:function(a){if(hqTool.hideLoad(),200!=a.code)return alert(a.message),!1;for(var e="",t=0;t<a.data.length;t++){var s=a.data[t],n=a.data[t].date,i=parseInt(n.substring(8,10));s.monType<0?(e+='<div class="f-td f-null f-lastMonth" onclick="calendar.prevMonth($(this))"><span class="f-day" data-id="'+n+'">'+i+"</span>",0!=s.status&&(e+='<span class="f-ke f-d-ke">课</span>'),0!=s.isAttend&&(e+='<div class="calendar-icon-p"><div class="calendar-icon calendar-icon-1 bg-cover"></div></div>'),e+="</div>"):0==s.monType?(e+=7<=t?'<div class="f-td f-number sign '+h.isShow+'" onclick="calendar.TodaySelected($(this))">':'<div class="f-td f-number" onclick="calendar.TodaySelected($(this))">',e+='<span class="f-day" data-id="'+n+'">'+i+"</span>",0!=s.status&&(e+='<span class="f-ke">课</span>'),0!=s.isAttend&&(e+='<div class="calendar-icon-p"><div class="calendar-icon calendar-icon-2 bg-cover"></div></div>'),e+="</div>"):0<s.monType&&(e+='<div class="f-td f-null f-nextMounth '+h.isShow+'" onclick="calendar.nextMonth($(this))"><span class="f-day" data-id="'+n+'">'+i+"</span>",0!=s.status&&(e+='<span class="f-ke f-d-ke">课</span>'),0!=s.isAttend&&(e+='<div class="calendar-icon-p"><div class="calendar-icon calendar-icon-1 bg-cover"></div></div>'),e+="</div>")}$(".f-rili-table .f-tbody").empty(),$(".f-rili-table .f-tbody").append(e),h.addStyle(),h.selectedDayStyle(),$("#showMore").find(".black-arrow-icon").removeClass("down-arrow-icon").addClass("top-arrow-icon"),$("#showMore").find(".text").text("收起本月课程"),$(".f-rili-table .f-tbody .sign,.f-rili-table .f-tbody .f-nextMounth").slideDown(),h.isShow="show","function"==typeof d&&d()}})},getWeekData:function(){hqTool.showLoad(h.businessId),$.ajax({url:"/learningCenter/web/live/calendar/week",type:"GET",async:!0,data:{userplanId:h.userPlanId,date:h.selectedDay},dataType:"json",success:function(a){if(hqTool.hideLoad(),200!=a.code)return alert(a.message),!1;for(var e="",t=0;t<a.data.length;t++){var s=a.data[t],n=a.data[t].date,i=parseInt(n.substring(8,10));s.monType<0?(e+='<div class="f-td f-null f-lastMonth" onclick="calendar.prevMonth($(this))"><span class="f-day" data-id="'+n+'">'+i+"</span>",0!=s.status&&(e+='<span class="f-ke f-d-ke">课</span>'),0!=s.isAttend&&(e+='<div class="calendar-icon-p"><div class="calendar-icon calendar-icon-1 bg-cover"></div></div>'),e+="</div>"):0==s.monType?(e+=7<=t?'<div class="f-td f-number sign '+h.isShow+'" onclick="calendar.TodaySelected($(this))">':'<div class="f-td f-number" onclick="calendar.TodaySelected($(this))">',e+='<span class="f-day" data-id="'+n+'">'+i+"</span>",0!=s.status&&(e+='<span class="f-ke">课</span>'),0!=s.isAttend&&(e+='<div class="calendar-icon-p"><div class="calendar-icon calendar-icon-2 bg-cover"></div></div>'),e+="</div>"):0<s.monType&&(e+='<div class="f-td f-null f-nextMounth '+h.isShow+'" onclick="calendar.nextMonth($(this))"><span class="f-day" data-id="'+n+'">'+i+"</span>",0!=s.status&&(e+='<span class="f-ke f-d-ke">课</span>'),0!=s.isAttend&&(e+='<div class="calendar-icon-p"><div class="calendar-icon calendar-icon-1 bg-cover"></div></div>'),e+="</div>")}if($("#showMore").find(".black-arrow-icon").hasClass("down-arrow-icon"))$(".f-rili-table .f-tbody").empty(),$(".f-rili-table .f-tbody").append(e),h.addStyle(),h.selectedDayStyle();else{var d=35;$(".f-rili-table .f-tbody .sign,.f-rili-table .f-tbody .f-nextMounth").slideUp(function(){--d||($(".f-rili-table .f-tbody").empty(),$(".f-rili-table .f-tbody").append(e),h.addStyle(),h.selectedDayStyle())}),$("#showMore").find(".black-arrow-icon").removeClass("top-arrow-icon").addClass("down-arrow-icon"),$("#showMore").find(".text").text("查看本月课程"),h.isShow="hide"}}})},getContent:function(){hqTool.showLoad(h.businessId),$.ajax({url:"/learningCenter/web/live/detail",type:"GET",async:!0,data:{userplanId:h.userPlanId,date:h.selectedDay},dataType:"json",success:function(a){if(hqTool.hideLoad(),$("#myCurriculumEmpty").hide(),200!=a.code)return alert(a.message),!1;var e="",t="";if(0<a.data.liveDetail.length||0<a.data.hope.length){if($("#liveBroadcast").empty(),$("#otherContent").empty(),""!=a.data.liveDetail){for(var s=0;s<a.data.liveDetail.length;s++){var n=a.data.liveDetail[s];e+='<div class="live-broadcast-bar"><div class="live-broadcast-title" data-id="'+n.classplanId+'">'+n.classplanName+"</div>";for(var i=0;i<a.data.liveDetail[s].list.length;i++){var d=a.data.liveDetail[s].list[i];e+='<div class="live-broadcast-list"><div class="fl"><div class="curriculum-name text-overflow"><span class="chapter" title="'+d.classplanLiveName+'">'+d.classplanLiveName+'</span></div></div><div class="right-content"><span class="name-bar"><span class="icon-p"><span class="persion-icon bg-cover"></span></span><span class="teacher text-overflow">'+d.teacher+'</span></span><span class="time-bar"><span class="curriculum-list-icon curriculum-list-icon-1 bg-cover"></span><span class="pl-5px">'+d.time+'</span></span><span class="attendance-progress"><span class="attendance-text">出勤</span><span class="progress-bar" style="width:78px;"><span class="progress-bg radius-8px" style="width:78px;"><span class="progress radius-8px" style="width:'+d.attendPer+'%"><span class="progress-text">'+d.attendPer+"%</span></span></span></span></span>",0==d.classStatus?e+='<a href="javascript:;" class="disabled-btn">未开始</a>':1==d.classStatus?e+='<a href="javascript:;" class="btn radius-5px" onclick="pageScript.goVideo(\''+d.classplanLiveId+"')\">即将开始</a>":2==d.classStatus?e+='<a href="javascript:;" class="btn radius-5px" onclick="pageScript.goVideo(\''+d.classplanLiveId+"')\">正在直播</a>":3==d.classStatus?e+='<a href="javascript:;" class="disabled-btn">已结束</a>':4==d.classStatus&&(e+='<a href="javascript:;" class="default-btn radius-5px" onclick="pageScript.goReplay(\''+d.classplanLiveId+"')\">观看回放</a>"),e+="</div></div>"}e+="</div>"}$("#liveBroadcast").append(e)}if(""!=a.data.hope){t+='<div class="other-content-title">你希望</div>';for(var l=0;l<a.data.hope.length;l++){var r=a.data.hope[l];if(0==r.type){t+='<div class="other-content-list-box">',t+='<div class="other-content-list-title text-overflow">'+r.name+"</div>",t+='<div class="line"></div>';for(var o=0;o<r.webData.length;o++){var c=r.webData[o];if(t+='<div class="other-content-list">',t+='<div class="pr">',t+='<div class="icon-box">',1==c.fileType?t+='<span class="other-content-icon-2 bg-cover cut-icon-1"></span>':2==c.fileType?t+='<span class="other-content-icon-2 bg-cover cut-icon-2"></span>':3==c.fileType?t+='<span class="other-content-icon-2 bg-cover cut-icon-3"></span>':4==c.fileType&&(t+='<span class="other-content-icon-2 bg-cover cut-icon-4"></span>'),t+="</div>",t+='<div class="small-box" data-isShow="1" onclick="calendar.showMoreDownloads($(this))">',t+='<div class="fl">'+c.name+"</div>",t+='<div class="fr"><div class="btn-bar"><span class="color-999">共 '+c.num+' 个文件</span><span class="grey-arrow-icon down-arrow-icon ml-10px"></span></div></div>',t+="</div>",t+="</div>",void 0!==c.fileData)for(var f=0;f<c.fileData.length;f++){var p=c.fileData[f];t+='<div class="other-content-list-2 hide"><div class="fl text-overflow" style="padding-right: 10px; width: 680px;"><span class="green-dot circle"></span><span class="text">'+p.fileName+'</span></div><div class="fr"><div class="btn-bar"><a href="'+p.fileUrl+'" class="btn radius-5px" target="_blank">下载</a></div></div></div>'}t+="</div>",t+="</div>"}t+="</div>"}}$("#otherContent").append(t)}else t+='<div class="other-content-title">你希望</div>',t+='<p class="text-center" style="margin-top: 50px;">暂无资料哦~</p>',$("#otherContent").append(t);h.progressAction()}else $("#liveBroadcast").empty(),$("#otherContent").empty(),$("#myCurriculumEmpty").show()}})},showMoreDownloads:function(a){"1"==a.attr("data-isShow")?(a.attr("data-isShow","2"),a.find(".grey-arrow-icon").removeClass("down-arrow-icon").addClass("top-arrow-icon"),a.parent().nextAll().show(300)):(a.attr("data-isShow","1"),a.find(".grey-arrow-icon").removeClass("top-arrow-icon").addClass("down-arrow-icon"),a.parent().nextAll().hide(300))},progressAction:function(){$(".live-broadcast-list").hover(function(){var a=parseInt($(this).find(".progress-text").text());0==a?$(this).find(".progress").animate({width:"100%"},300):a<30&&$(this).find(".progress").animate({width:"35%"},300)},function(){var a=parseInt($(this).find(".progress-text").text());$(this).find(".progress").animate({width:a+"%"},300)})},formatDate:function(a){var e=a.getFullYear()+"-",t=a.getMonth()+1+"-",s=a.getDate();return parseInt(t)<10&&(t="0"+t),s<10&&(s="0"+s),e+t+s},addDate:function(a,e){return a.setDate(a.getDate()+e),a},setDate:function(t){return h.currentFirstDate=new Date(t),$("#showMore .black-arrow-icon").hasClass("down-arrow-icon")&&h.isPrevNext&&$(".f-rili-table .f-td").each(function(a,e){0==a&&(h.selectedDay=h.formatDate(0==a?t:h.addDate(t,1)))}),!1},DateDiff:function(a,e){var t,s,n;return t=a.split("-"),s=new Date(t[1]+"-"+t[2]+"-"+t[0]),t=e.split("-"),n=new Date(t[1]+"-"+t[2]+"-"+t[0]),parseInt(Math.abs(s-n)/1e3/60/60/24)}};window.calendar=new h.init}();